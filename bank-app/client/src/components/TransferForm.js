import React, { Component } from 'react';
import axios from 'axios';

class TransferForm extends Component {
    constructor(props) {
        super(props);
            this.state = {
            membershipId: '',
            memberName: '',
            membershipIdConfirmation: '',
            transferAmount: ''
        };
    }
    
    // To return the current Date as a string
    getDate = () => {
        const currentDate = new Date();

        // To get date without time
        //currentDate.setHours(0, 0, 0, 0);
        
        // To keep only the date portion
        return currentDate.toISOString().split('T')[0];
    };
    
    
    // Returns true if membershipId is of correct format
    membershipValidation = (membershipId) => {
        // TODO 
        // Grab validation format from DB (After LoyaltyProgramQuery API is implemented)
        return true;
    };

    handleSubmit = (event) => {
        event.preventDefault();
        const { membershipId, memberName, membershipIdConfirmation, transferAmount } = this.state;

        const transferDate = this.getDate();

        if (membershipId === membershipIdConfirmation && this.membershipValidation(membershipId)) {
            const form = {
                membershipId,
                memberName,
                transferDate,
                transferAmount
            };
            
            console.log(form);

            axios.post('http://localhost:3001/api/transferFormSubmit', form)
                .then(response => {
                    // TODO, save referenceNumber generated by TransferConnect app
                    console.log(response.data);
                })
                .catch(error => {
                    console.error(error);
                });
        }
        else {
            // TODO if the membershipId is not valid or not of confirmation
            return;
        }
    }

    handleChange = (event) => {
        const { name, value } = event.target;
        this.setState({ [name]: value });
    }

    render() {
        const { memberName, membershipId, membershipIdConfirmation, transferAmount } = this.state;

        return (
            <div>
                <form onSubmit={this.handleSubmit}>
                    <label htmlFor="memberName">PRIMARY CARDHOLDER</label>
                    <input
                        type="text"
                        id="memberName"
                        name="memberName"
                        value={memberName}
                        onChange={this.handleChange}
                    />
                    <br />

                    <label htmlFor="membershipId">MEMBERSHIP #</label>
                    <input
                        type="text"
                        id="membershipId"
                        name="membershipId"
                        value={membershipId}
                        onChange={this.handleChange}
                    />
                    <br />

                    <label htmlFor="membershipIdConfirmation">CONFIRM MEMBERSHIP #</label>
                    <input
                        type="text"
                        id="membershipIdConfirmation"
                        name="membershipIdConfirmation"
                        value={membershipIdConfirmation}
                        onChange={this.handleChange}
                    />
                    <br />

                    <label htmlFor="transferAmount">TRANSFER AMOUNT</label>
                    <input
                        type="text"
                        id="transferAmount"
                        name="transferAmount"
                        value={transferAmount}
                        onChange={this.handleChange}
                    />
                    <br />

                    <input
                        type="submit"
                        value="Submit"
                    />
                </form>
            </div>
        );
    }
}

export default TransferForm;
